<?xml version="1.0"?>
<launch>
    <!-- Launch arguments -->
    <arg name="mode" default="MAP" description="Mode of operation: MAP only (simplified for time trial racing)" />
    <arg name="sim_mode" default="false" description="Use simulation mode if true, real car mode if false" />
    <arg name="l1_params_path" default="$(find-pkg-share controller)/config/l1_params.yaml" />
    <arg name="lookup_table_path" default="$(find-pkg-share controller)/config/RBC1_pacejka_lookup_table.csv" />

    <!-- Controller node with conditional remapping based on sim_mode -->
    <node pkg="controller" name="controller_manager" exec="controller_manager_node" output="screen">
        <param name="mode" value="$(var mode)" />
        <param name="l1_params_path" value="$(var l1_params_path)" />
        <param name="lookup_table_path" value="$(var lookup_table_path)" />

        <!-- Topic remappings for simulation mode -->
        <remap from="/planned_path" to="/planned_waypoints" if="$(var sim_mode)" />
        <remap from="/odom" to="/ego_racecar/odom" if="$(var sim_mode)" />

        <!-- Topic remappings for real car mode -->
        <remap from="/planned_path" to="/planned_waypoints" unless="$(var sim_mode)" />
        <remap from="/odom" to="/pf/pose/odom" unless="$(var sim_mode)" />

        <!--
        <param name="map_path" value="/home/lmw/sim_ws/f1tenth_gym_ros/maps/icra_2_clean"/>
        <param name="racecar_version" value="RBC1"/>
        <param name="sim" value="true"/>
        -->
    </node>
</launch>
